var ekmProductImageBadges=function(){"use strict";var e=function(e,t){var r=document.createElement("img");r.className="ekm-product-image-badge-preload",r.setAttribute("src",e);var n=document.getElementsByTagName("body")[0];n.appendChild(r),r.complete?(t(e,r.width,r.height),n.removeChild(r)):r.onload=function(){setTimeout(function(){t(e,r.width,r.height),n.removeChild(r)},100)}},t=function(e,t){if(this._element=e,t)for(var r=["theme","locale","spacing","yOffset","xOffset","direction","siteName","maxWidth","maxHeight"],n=0;n<r.length;n++){var i=r[n];t.hasOwnProperty(i)&&(this["_"+i]=t[i])}this._initialise()};t.prototype={_element:null,_wrapper:null,_badges:["blue-10%off","blue-15%off","blue-20%off","blue-25%off","blue-50%off","blue-75%off","blue-bestdeal","blue-bestseller","blue-clearance","blue-exclusive","blue-freedelivery","blue-halfprice","blue-lastchance","blue-limitededition","blue-newin","blue-onlineexclusive","blue-perfectgift","blue-premium","blue-sale","blue-specialoffer","blue-top10","blue-top5","green-10%off","green-15%off","green-20%off","green-25%off","green-50%off","green-75%off","green-bestdeal","green-bestseller","green-clearance","green-exclusive","green-freedelivery","green-halfprice","green-lastchance","green-limitededition","green-newin","green-onlineexclusive","green-perfectgift","green-premium","green-sale","green-specialoffer","green-top10","green-top5","orange-10%off","orange-15%off","orange-20%off","orange-25%off","orange-50%off","orange-75%off","orange-bestdeal","orange-bestseller","orange-clearance","orange-exclusive","orange-freedelivery","orange-halfprice","orange-lastchance","orange-limitededition","orange-newin","orange-onlineexclusive","orange-perfectgift","orange-premium","orange-sale","orange-specialoffer","orange-top10","orange-top5","pink-10%off","pink-15%off","pink-20%off","pink-25%off","pink-50%off","pink-75%off","pink-bestdeal","pink-bestseller","pink-clearance","pink-exclusive","pink-freedelivery","pink-halfprice","pink-lastchance","pink-limitededition","pink-newin","pink-onlineexclusive","pink-perfectgift","pink-premium","pink-sale","pink-specialoffer","pink-top10","pink-top5","purple-10%off","purple-15%off","purple-20%off","purple-25%off","purple-50%off","purple-75%off","purple-bestdeal","purple-bestseller","purple-clearance","purple-exclusive","purple-freedelivery","purple-halfprice","purple-lastchance","purple-limitededition","purple-newin","purple-onlineexclusive","purple-perfectgift","purple-premium","purple-sale","purple-specialoffer","purple-top10","purple-top5","red-10%off","red-15%off","red-20%off","red-25%off","red-50%off","red-75%off","red-bestdeal","red-bestseller","red-clearance","red-exclusive","red-freedelivery","red-halfprice","red-lastchance","red-limitededition","red-newin","red-onlineexclusive","red-perfectgift","red-premium","red-sale","red-specialoffer","red-top10","red-top5","yellow-10%off","yellow-15%off","yellow-20%off","yellow-25%off","yellow-50%off","yellow-75%off","yellow-bestdeal","yellow-bestseller","yellow-clearance","yellow-exclusive","yellow-freedelivery","yellow-halfprice","yellow-lastchance","yellow-limitededition","yellow-newin","yellow-onlineexclusive","yellow-perfectgift","yellow-premium","yellow-sale","yellow-specialoffer","yellow-top10","yellow-top5"],_basePath:"/ekmps/images/productbadges/",_locale:"English",_theme:"Rose/Small",_spacing:2,_yOffset:0,_xOffset:0,_direction:"vertical",_siteName:"",_maxWidth:null,_maxHeight:null,_initialise:function(){var t=this._element,r=this._badges,n=this._basePath,i=this._locale,l=this._theme,a=this._spacing,o=this._yOffset,f=this._xOffset,s=this._direction,p=this._siteName,u=this,d=this._wrapper=document.createElement("span");d.className="ekm-product-image-badge-wrapper",t.nextSibling?t.parentNode.insertBefore(d,t.nextSibling):t.parentNode.appendChild(d),this._positionWrapper(d,t,!0);var c,g=o,m=f,h=/\.(?:png|gif|jpg|jpeg)$/i,b=this._maxWidth||t.getAttribute("data-ekm-badges-max-width")||999,v=this._maxHeight||t.getAttribute("data-ekm-badges-max-height")||999;if(null!==t.getAttribute("data-ekm-badges-max-width-orig")||null!==t.getAttribute("data-ekm-badges-max-height-orig")){var y=document.createElement("img");y.src=t.querySelector("img").src;var w=Math.round(b/y.width),k=Math.round(v/y.height),x=Math.min(w,k);g*=x,m*=x,a*=x}c="IMG"==t.nodeName?t:t.querySelector("img"),b>c.width/2&&(b=c.width/2),v>c.height/2&&(v=c.height/2);var _=t.getAttribute("data-ekm-badges")||"";_=_.split(" ");for(var A=0;A<_.length;A++){var N,E=_[A];if(this._inArray(r,E))N=n+i+"/"+l+"/"+encodeURIComponent(E)+".png";else{if(!h.test(E))continue;N="/ekmps/shops/"+p+"/resources/Design/"+encodeURIComponent(E)}e(N,function(e,t,r){var n=1;t>b&&(n=b/t),r*n>v&&(n=v/r),t=Math.floor(t*n),r=Math.floor(r*n);var i=u._createBadgeElement(e,t,r);d.appendChild(i),i.style.bottom=g+"px",i.style.right=m+"px","vertical"==s?g=g+r+a:m=m+t+a})}},_positionWrapper:function(e,t,r){var n=t.getElementsByTagName("img")[0];if(n){if(r){var i=document.createElement("span");i.appendChild(document.createTextNode(".")),e.appendChild(i)}var l=n.getBoundingClientRect(),a=e.getBoundingClientRect(),o=l.right-a.right,f=l.bottom-a.bottom;if(0==l.width){var s=this;n.onload=function(){s._positionWrapper(e,t,!1)}}e.style.left=o+"px",e.style.top=f+"px"}},_createBadgeElement:function(e,t,n){var i=this._element,l=document.createElement("img");return l.setAttribute("src",e),l.setAttribute("width",t),l.setAttribute("height",n),l.className="ekm-product-image-badge",r(l,"click",function(){i.click()}),l},_inArray:function(e,t){for(var r=e.length-1;r>=0;r--)if(e[r]==t)return!0;return!1}};var r=function(e,t,r){e.addEventListener?e.addEventListener(t,r,!1):e.attachEvent&&e.attachEvent("on"+t,r)},n=function(e){if(e.childNodes.length>0)for(var t=0,r=e.childNodes.length;t<r;t++)if(1===e.childNodes[t].nodeType)return e.childNodes[t];for(var n=e.nextSibling;null!==n;){if(1===n.nodeType)return n;n=n.nextSibling}for(var i=e.parentNode;null!==i;){if(1!==i.nodeType)return null;for(n=i.nextSibling;null!==n;){if(1===n.nodeType)return n;n=n.nextSibling}i=i.parentNode}return null},i=function(e){for(var t=1,r=arguments.length;t<r;t++){var n=arguments[t];for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i])}return e},l=function(e,t,r){r=r||null;for(var n=[].slice.call(e,0),i=0,l=n.length;i<l;i++)t.call(r,n[i],i,n)};r(window,"load",function e(){var t,n,i;t=window,n="load",i=e,t.removeEventListener?t.removeEventListener(n,i,!1):t.detachEvent&&t.detachEvent("on"+n,i),r(window,"reset",function(e){"ekm-sortby-form"!==e.target.className&&"ekm-filterby-form"!==e.target.className||setTimeout(p,100)}),f()});var a={},o=!1,f=function(){var e=!o;o=!0;for(var r="Rose/Small",n=null,l=0,f=0,s=0,p="vertical",d=null,c=document.getElementsByTagName("script"),g=0;g<c.length;g++){var m=c[g],h=m.getAttribute("data-ekm-product-badge-style");if(h){r=h,n=m.getAttribute("data-ekm-locale"),l=parseInt(m.getAttribute("data-ekm-product-badge-spacing"),10),f=parseInt(m.getAttribute("data-ekm-product-badge-x"),10),s=parseInt(m.getAttribute("data-ekm-product-badge-y"),10),p=m.getAttribute("data-ekm-product-badge-dir"),d=m.getAttribute("data-ekm-sitename");break}}var b=[];!function(){for(var e=document.getElementsByTagName("img"),t=0;t<e.length;t++){for(var r=e[t];9!=r.nodeType&&!r.hasAttribute("data-ekm-badges");)r=r.parentNode;9!=r.nodeType&&r.hasAttribute("data-ekm-badges")&&(b[b.length]=r)}}();for(g=0;g<b.length;g++){var v=i({},a,{theme:r,locale:n,spacing:l,xOffset:f,yOffset:s,direction:p,siteName:d});new t(b[g],v)}e&&u()},s=function(){for(var e=function(e,t){if((t=t||document.documentElement).getElementsByClassName)return[].slice.call(t.getElementsByClassName(e),0);for(var r=[],i=n(t);null!==i&&i!==t.nextSibling;){for(var l=i.className.split(" "),a=0,o=l.length;a<o;a++)if(l[a]===e){r[r.length]=i;break}i=n(i)}return r}("ekm-product-image-badge-wrapper"),t=0,r=e.length;t<r;t++){var i=e[t];i.parentNode&&i.parentNode.removeChild(i)}},p=function(){s(),f()},u=function(){var e=null;r(window,"resize",function(t){clearTimeout(e),e=setTimeout(p,250)})};return{init:f,distroy:s,reInit:p,hasInitialised:function(){return o},setOptions:function(e){i(a,e)},setScopedOptions:function(e,t){document.querySelectorAll&&l(document.querySelectorAll(e),function(e){l(e.querySelectorAll("*[data-ekm-badges]"),function(e){!function(e,t){for(var r in t)if(t.hasOwnProperty(r)){var n="data-ekm-badges-"+r.replace(/[A-Z]/g,function(e){return"-"+e.toLowerCase()}),i=n+"-orig",l=t[r],a=e.getAttribute(i);if(null===a){var o=e.getAttribute(n);e.setAttribute(i,o)}"null"===a&&(a=null),null===l?null!==a?e.setAttribute(n,a):e.removeAttribute(n):e.setAttribute(n,l)}}(e,t)})})}}}();